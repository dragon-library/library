<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Send email using SMTP"><meta property="og:title" content="Send email using SMTP" />
<meta property="og:description" content="Use Python to send email using SMTP Use Python to send emails
In this tutorial, we will learn to use python to send emails. If you are new to python, you can see our beginner’s series. In case you are having trouble installing Python, you can see our posts on installing python on MacOS and Windows.
We will start with sending plain email using python and then learn to send advanced automated emails, HTML emails, emails with attachments etc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dragon-library.github.io/library/tutorials/docs/articles/python/use-python-send-email/" />
<meta property="article:published_time" content="2020-01-18T10:42:26+06:00" />
<meta property="article:modified_time" content="2020-01-18T10:42:26+06:00" />
<title>Send email using SMTP | Tutorials</title>
<link rel="icon" href="/library/tutorials/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/library/tutorials/book.min.0bbb1b2ec3079d329cb8e5a2adb6fc66611f3ba7b845024d4147abefe1834ceb.css" integrity="sha256-C7sbLsMHnTKcuOWirbb8ZmEfO6e4RQJNQUer7&#43;GDTOs=">


<script defer src="/library/tutorials/en.search.min.7fded2205ee93e1ee75b51b4f0f1ad2b9e491c897a3a7fe79d27a78ea228cb82.js" integrity="sha256-f97SIF7pPh7nW1G08PGtK55JHIl6On/nnSenjqIoy4I="></script>
<!-- highlight -->
  <link rel="stylesheet" href="https://dragon-library.github.io/library/tutorials/plugins/highlight/hybrid.css">


<!-- match-height JS -->
<script src="https://dragon-library.github.io/library/tutorials/plugins/match-height/jquery.matchHeight-min.js"></script>

<!-- highlight -->
<script src="https://dragon-library.github.io/library/tutorials/plugins/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://dragon-library.github.io/library/tutorials/"><span>Tutorials</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/" >
      Python
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/front-end/bootstrap/basic-bootstap/" >
      Bootstrap 4 แบบพื้นฐาน
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/front-end/javascript/" >
      JavaScript
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/articles/" >
      Articles
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/articles/python/" >
      Python
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/24-trick-python/" >
      24 เคล็ดลับ การใช้งาน Python
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/71-python-code-snippet/" >
      71 Python Code Snippets
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/81-pythoncodesnippets/" >
      81 Python Code Snippets
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-101/" >
      Python 101
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/from-zero/" >
      From Zero to Hero
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/useful-python-tricks/" >
      An A-Z of useful Python tricks
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-code-example/" >
      Code Examples
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/onverting-strings-to-datetime/" >
      Converting Strings using datetime
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/date-time/" >
      Datetime
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-for-pdf-02/" >
      Extract table from PDF
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-functions_and-functional-programming/" >
      Functions and Functional Programming
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-api-tutorial/" >
      Getting Started with APIs
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-pickle-module/" >
      Introduction Pickle Module
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/oop-in-python/" >
      OOP in Python
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-optimizations/" >
      Optimizations
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/overloading-functions/" >
      Overloading Functions and Operators
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-dictionary-tutorial/" >
      Python Dictionary Tutorial
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-for-pdf-01/" >
      Python for PDF
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-programming-in-r/" >
      Python Programming in R
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-time-module./" >
      Python Time Module
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-scala-comparison-part-1/" >
      Python vs. Scala  (Part I)
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-scala-comparison-part-2/" >
      Python vs. Scala  (Part II)
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/use-python-send-email/"  class="active">
      Send email using SMTP
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/set-passwords-and-secret-keys/" >
      Set Passwords and Secret Keys
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/virtualenv/" >
      การใช้งาน Virtualenv
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/articles/python/python-101-for-beginner/" >
      Python 101 สําหรับมือใหม่
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/articles/data-science/" >
      Data Sciene
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/articles/website/" >
      Website
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/articles/git/" >
      Git
  </a>


    

    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/book/" >
      Book
  </a>


    

    






  </li>


      
    
  </ul>
  



  











</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/library/tutorials/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Send email using SMTP</strong>
</header>

      
<article class="markdown">

<h1 id="use-python-to-send-email-using-smtp">Use Python to send email using SMTP</h1>

<p><strong>Use Python to send emails</strong></p>

<p>In this tutorial, we will learn to use  <a href="https://www.python.org/">python</a>  to send emails. If you are new to python, you can see our  <a href="https://saralgyaan.com/posts/chapter-1-introduction/">beginner’s series</a>. In case you are having trouble installing Python, you can see our posts on installing python on  <a href="https://saralgyaan.com/posts/how-to-install-python-3-on-macos-and-linux/">MacOS</a>  and  <a href="https://saralgyaan.com/posts/how-to-install-python-on-windows-pc/">Windows</a>.</p>

<p>We will start with sending plain email using python and then learn to send advanced automated emails, HTML emails, emails with attachments etc. In this tutorial, we will be using  <a href="https://mail.google.com/">gmail</a>  to send email via python, which is the most common email service used. However, you can use any other email service.(You will have to use slightly different setting in that case.)</p>

<p>Open your gmail account. If you are not using</p>

<p><a href="https://www.google.com/landing/2step/">2-Step Verification</a>, you will have to allow less secure apps from this  <a href="https://myaccount.google.com/lesssecureapps?pli=1">link</a>.</p>

<p><img src="https://saralgyaan.com/media/images/uploads/2019/08/14/d9c92c1594-python-send-emails-...png" alt="python send emails ...png" /></p>

<p>However, if you are using  <a href="https://www.google.com/landing/2step/">2-Step Verification</a>  (which I highly recommend), you need to create app password for your account for this project from  <a href="https://myaccount.google.com/u/2/apppasswords">here</a>. You can learn to create app passwords from google’s  <a href="https://support.google.com/accounts/answer/185833">official documentation</a>.</p>

<p>We do not want to hard code our username and password, so we will be using  <a href="https://saralgyaan.com/posts/set-passwords-and-secret-keys-in-environment-variables-maclinuxwindows-python-quicktip/">environment variable to set them</a>. Open the .bash_profile of your MacOS and save the email and password (or app password in case of 2-step verification) as under:-</p>

<pre><code class="language-py">$ nano .bash_profile
</code></pre>

<pre><code class="language-py"># .bash_profile
export EMAIL_USER=&quot;your_email&quot;
export PASSWORD=&quot;your_password&quot;
</code></pre>

<pre><code class="language-py">$ source .bash_profile
</code></pre>

<p><strong>Sending simple email using python</strong></p>

<p>Now create a file called ‘python_send_email.py’ and import  <a href="https://docs.python.org/3/library/smtplib.html">smtplib</a>  and write down the following code:-</p>

<pre><code class="language-py"># python_send_email.py

import os
import smtplib

EMAIL = os.environ.get('EMAIL_USER')
PASSWORD = os.environ.get('PASSWORD')

with smtplib.SMTP('smtp.gmail.com', 587) as smtp:
    smtp.ehlo()
    smtp.starttls()
    smtp.ehlo()
    smtp.login(EMAIL, PASSWORD)
    subject = 'Python Send Email'
    body = 'This email is sent using python'
    message = f'Subject:{subject}\n\n{body}'
    smtp.sendmail(EMAIL, EMAIL, message)
</code></pre>

<p>Let me quickly go through each step.</p>

<p>We have used os to use  <a href="https://docs.python.org/3/library/os.html#os.environ,">environment variables</a>  where we have saved our username and password.<br />
Then we have used the  <a href="http://book.pythontips.com/en/latest/context_managers.html">context manager</a>, so that the connection ends by itself after the script is complete.</p>

<p>Then we identified ourselves using  <a href="https://docs.python.org/3/library/smtplib.html#smtplib.SMTP.ehlo">smtp.ehlo()</a>, then we put it in the connection mode using  <a href="https://docs.python.org/3/library/smtplib.html#smtplib.SMTP.starttls">smtp.starttls()</a>  and logged in using  <a href="https://docs.python.org/3/library/smtplib.html#smtplib.SMTP.login">smtp.login()</a>.</p>

<p>Finally, we will draft the email by adding subject, body, message and send it using  <a href="https://docs.python.org/3/library/smtplib.html#smtplib.SMTP.sendmail">smtp.sendmail(sender, receipient, message)</a>. Running the script will send the simple email to the user.</p>

<p><img src="https://saralgyaan.com/media/images/uploads/2019/08/14/1364822ec9-python-send-emails-_.png" alt="python send emails _.png" /></p>

<p><strong>Sending email using local debugging server</strong></p>

<p>While we are testing/learning, it could be frustrating to use real email, so we will start local debugging server using the following command. When we will run this, all the future emails which we will send using our script will be displayed on the terminal.</p>

<pre><code class="language-py">$ python -m smtpd -c DebuggingServer -n localhost:1025
</code></pre>

<p>Now, we will have to make following changes to python_send_email.py :-</p>

<pre><code class="language-py"># python_send_email.py

# with smtplib.SMTP('smtp.gmail.com', 587) as smtp:
with smtplib.SMTP('localhost', 1025) as smtp:    #add this and comment out the rest
    # smtp.ehlo()
    # smtp.starttls()
    # smtp.ehlo()
    # smtp.login(EMAIL, PASSWORD)
</code></pre>

<p>Now if we will run our python_send_email.py, it will be displayed in the terminal.</p>

<p><img src="https://saralgyaan.com/media/images/uploads/2019/08/14/42f1b44e5a-python-send-email-!.png" alt="python send email !.png" /></p>

<p><strong>Cleaning it up</strong></p>

<p>Instead of calling the server using  <a href="https://docs.python.org/3/library/smtplib.html#smtplib.SMTP.ehlo">smtp.ehlo()</a>  we will be creating a SSL connection from the very beginning using  <a href="https://docs.python.org/3/library/smtplib.html#smtplib.SMTP_SSL">smptlib.SMTP_SSL</a>  and instead of port 587, we will use port 465. Now, we will be taking advantage of EmailMessage class of email.message to create a message and finally  <a href="https://docs.python.org/3/library/smtplib.html#smtplib.SMTP.send_message">smtp.send_message()</a>  to send that message. The modified code is as under:-</p>

<pre><code class="language-py"># python_send_email.py

import os
import smtplib
from email.message import EmailMessage #new

EMAIL = os.environ.get('EMAIL_USER')
PASSWORD = os.environ.get('PASSWORD')

message = EmailMessage()
message['Subject'] = 'Python Send Email'
message['From'] = EMAIL
message['To'] = EMAIL
message.set_content('This email is sent using python.')

with smtplib.SMTP_SSL('smtp.gmail.com', 465) as smtp:
    smtp.login(EMAIL, PASSWORD)
    smtp.send_message(message)
</code></pre>

<p><strong>Python - send email with attachment</strong></p>

<p>Now we will be sending the emails with attachment. In order to send an image we will be using  <a href="https://docs.python.org/3/library/imghdr.html#module-imghdr">imghdr</a>  to find out the type of the image. Now place the image python_send_email.jpg in the same directory as the script python_send_email.py and change the code as under:</p>

<pre><code class="language-py"># python_send_email.py

import imghdr # new


with open('python_send_email.jpg', 'rb') as f:
    file_data = f.read()
    file_type = imghdr.what(f.name)
    file_name = f.name

message.add_attachment(file_data, maintype='image', subtype=file_type, filename=file_name)
</code></pre>

<blockquote>
<p>Written with <a href="https://saralgyaan.com/posts/use-python-to-send-email/">StackEdit</a>.</p>
</blockquote>
</article>

      <div class="book-footer justify-between">
  

  

  
  <div>
    <a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/edit/master/exampleSite/content/docs%5cArticles%5cpython%5cUse-Python-send-email.md" target="_blank">
      <img src="/library/tutorials/svg/edit.svg" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>
  

</div>

      
    </div>

    
  

  <aside class="book-toc levels-3 fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#use-python-to-send-email-using-smtp">Use Python to send email using SMTP</a></li>
</ul>
</nav>
  </aside>



  </main>

  
</body>

</html>
