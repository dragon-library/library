<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Ep.10 Flask and the Fetch API"><meta property="og:title" content="Ep.10 Flask and the Fetch API" />
<meta property="og:description" content="Flask and the Fetch API | Learning Flask Ep. 10 Asynchronous requests from the client to the server using the JavaScript Fetch API
Making asynchronus requests from the client to the server is a common feature of most modern web applications, allowing a more fluid user experience.
In this episode of the &ldquo;Learning Flask&rdquo; series, you&rsquo;ll learn how to make asynchronus requests from the client to your application using some basic vanilla JavaScript and the Fetch API." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dragon-library.github.io/library/tutorials/docs/python/flask/learning-flask/ep-10/" />

<title>Ep.10 Flask and the Fetch API | Tutorials</title>
<link rel="icon" href="/library/tutorials/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/library/tutorials/book.min.47182b9e4e24c896682aed975b295d906b0f9c78590335fc280e08fe01949ee2.css" integrity="sha256-Rxgrnk4kyJZoKu2XWyldkGsPnHhZAzX8KA4I/gGUnuI=">


<script defer src="/library/tutorials/en.search.min.26cb3d9204a66106df001cab84be01af525d3219b3578836137d655235f579a9.js" integrity="sha256-Jss9kgSmYQbfAByrhL4Br1JdMhmzV4g2E31lUjX1eak="></script>
<!-- highlight -->
  <link rel="stylesheet" href="https://dragon-library.github.io/library/tutorials/plugins/highlight/hybrid.css">


<!-- match-height JS -->
<script src="https://dragon-library.github.io/library/tutorials/plugins/match-height/jquery.matchHeight-min.js"></script>

<!-- highlight -->
<script src="https://dragon-library.github.io/library/tutorials/plugins/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://dragon-library.github.io/library/tutorials/"><span>Tutorials</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/" >
      Python
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/beginer/" >
      Beginners
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/pandas/" >
      Pandas
  </a>


    

    






  </li>


      
    
      
        <li>

  <a href="/library/tutorials/docs/python/pythonthailand/" >
      Python Thailand
  </a>

</li>
      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/snippets/" >
      Snippets
  </a>


    

    






  </li>


      
    
      
        <li>

  <a href="/library/tutorials/docs/python/important-basic-syntax/" >
      ไวยกรณ์พื้นฐานที่จำเป็น
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/awesome/" >
      Awesome Python
  </a>

</li>
      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/e-book/" >
      e-Book
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/flask/" >
      Flask
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/flask/learning-flask/" >
      Learning Flask
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-1/" >
      Ep.1 Your first Flask app
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-2/" >
      Ep.2 Flask application structure
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-3/" >
      Ep.3 Serving HTML files
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-4/" >
      Ep.4 Serving static files
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-5/" >
      Ep.5 Jinja template inheritance
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-6/" >
      Ep.6 Jinja template design
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-7/" >
      Ep.7 Working with forms in Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-8/" >
      Ep.8 Generating dynamic URLs in Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-9/" >
      Ep.9 Working with JSON data
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-10/"  class="active">
      Ep.10 Flask and the Fetch API
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-11/" >
      Ep.11 Query strings in Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-12/" >
      Ep.12 Flask configuration files
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-13/" >
      Ep.13 Uploading files with Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-14/" >
      Ep.14 Sending files with Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-15/" >
      Ep.15 Flask cookies
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-16/" >
      Ep.16 The Flask session object
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-17/" >
      Ep.17 Flask message flashing
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-18/" >
      Ep.18 Flask error handling
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-19/" >
      Ep.19 Flask HTTP methods
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-20/" >
      Ep.20 The request object
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-21/" >
      Ep.21 Task queues with Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-22/" >
      Ep.22 Pillow, task queues &amp; the HTML picture element
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/primer-jinja-templating/" >
      Primer on Jinja Templating
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/flask-blueprint/" >
      Use a Flask Blueprint
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        <li>

  <a href="/library/tutorials/docs/python/cheat-sheet/" >
      Python Cheat sheet
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/list-python-basics/" >
      List for Tutorial
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/modules-list/" >
      Modules List
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/python-regular-expressions/" >
      Regular Expressions
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/database/" >
      Database
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/backup/" >
      Backup
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/articles/" >
      Articles
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/book/" >
      Book
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/front-end/" >
      Front-End
  </a>


    

    






  </li>


      
    
  </ul>
  



  











</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/library/tutorials/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Ep.10 Flask and the Fetch API</strong>
</header>

      
<article class="markdown">

<h1 id="flask-and-the-fetch-api-learning-flask-ep-10">Flask and the Fetch API | Learning Flask Ep. 10</h1>

<p>Asynchronous requests from the client to the server using the JavaScript Fetch API</p>

<p>Making asynchronus requests from the client to the server is a common feature of most modern web applications, allowing a more fluid user experience.</p>

<p>In this episode of the &ldquo;Learning Flask&rdquo; series, you&rsquo;ll learn how to make asynchronus requests from the client to your application using some basic vanilla JavaScript and the Fetch API.</p>

<p>The Fetch API supersedes XML AJAX requests, allowing a relitively clean and simple promise based way to post and fetch data to and from the server, with a simple yet powerful feature set for catching errors and bad requests.</p>

<h3 id="create-a-new-route">Create a new route</h3>

<p>For this example, we&rsquo;re going to be building a simple guestbook, allowing our users to post their name and message along with reading other previous entries.</p>

<p>We&rsquo;ll use the Fetch API to post a new entry and a JavaScript function to render the entries to our template.</p>

<p>Let&rsquo;s start with a new route called  <code>/guestbook</code>:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">@app.route(&quot;/guestbook&quot;)
def guestbook():
    return render_template(&quot;public/guestbook.html&quot;)
</code></pre>

<p>We&rsquo;ll need to create a new template too. Go ahead and create  <code>guestbook.html</code>  in the  <code>public</code>  directory and add the following:</p>

<p><strong>app/app/templates/public/guestbook.html</strong></p>

<pre><code class="language-html">{% extends &quot;public/templates/public_template.html&quot; %}

{% block title %}Guestbook{% endblock %}

{% block main %}

&lt;div class=&quot;container&quot;&gt;
  &lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;col&quot;&gt;

      &lt;h1&gt;Guestbook&lt;/h1&gt;
      &lt;hr&gt;

    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

{% endblock %}
</code></pre>

<p>Save the files and head to  <code>/guestbook</code>  in the browser to see the new template.</p>

<blockquote>
<p>Note - We&rsquo;re using the Bootstrap 4 library for CSS</p>
</blockquote>

<p>We&rsquo;ll need some input fields for our users to fill out the guestbook.</p>

<p>We&rsquo;ll add an input field for  <code>name</code>  and a textarea for  <code>message</code>  along with a button to submit their entry:</p>

<p><strong>app/app/templates/public/guestbook.html</strong></p>

<pre><code class="language-html">{% extends &quot;public/templates/public_template.html&quot; %}

{% block title %}Guestbook{% endblock %}

{% block main %}

&lt;div class=&quot;container&quot;&gt;
  &lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;col&quot;&gt;

      &lt;h1&gt;Guestbook&lt;/h1&gt;
      &lt;hr&gt;

      &lt;div class=&quot;mb-3&quot;&gt;
        &lt;div class=&quot;form-group&quot;&gt;
          &lt;label&gt;Name&lt;/label&gt;
          &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;name&quot; placeholder=&quot;Your name&quot;&gt;
        &lt;/div&gt;

        &lt;div class=&quot;form-group&quot;&gt;
          &lt;label&gt;Message&lt;/label&gt;
          &lt;textarea class=&quot;form-control&quot; id=&quot;message&quot; cols=&quot;30&quot; rows=&quot;3&quot; placeholder=&quot;Your message&quot;&gt;&lt;/textarea&gt;
        &lt;/div&gt;

        &lt;button class=&quot;btn btn-primary&quot; id=&quot;submit&quot; onclick=&quot;submit_message();&quot;&gt;Submit message&lt;/button&gt;
      &lt;/div&gt;

      &lt;h3&gt;Messages&lt;/h3&gt;
      &lt;hr&gt;

      &lt;div class=&quot;mb-3&quot; id=&quot;messages&quot;&gt;&lt;/div&gt;

    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

{% endblock %}

{% block script %}
</code></pre>

<p>Notice we&rsquo;ve set an id attribute on the input elements and the button. We&rsquo;ll create a function to submit the data when the button is clicked, collecting the values from the input fields and posting it to our Flask app.</p>

<p>We&rsquo;ve also added a new heading and a  <code>&lt;div&gt;</code>  element with the id  <code>messages</code>. We&rsquo;ll use this div to display the entries of our guestbook later.</p>

<h3 id="collecting-json">Collecting JSON</h3>

<p>We&rsquo;re going to wrap all of our JavaScript in a set of  <code>{% block script %} {% endblock %}</code>  tags with corresponding  <code>{% block script %} {% endblock %}</code>  tags in our base template.</p>

<p>Let&rsquo;s create a function to collect the input values and create a new JSON object when the button is clicked:</p>

<p><strong>app/app/templates/public/guestbook.html</strong></p>

<pre><code class="language-html">{% block script %}

&lt;script&gt;

    function submit_message() {

        var name = document.getElementById(&quot;name&quot;);
        var message = document.getElementById(&quot;message&quot;);

        var entry = {
            name: name.value,
            message: message.value
        };
    }

&lt;/script&gt;

{% endblock %}
</code></pre>

<p>We need to attach this function to the submit button. Go ahead and refactor the  <code>&lt;button&gt;</code>  element to the following:</p>

<pre><code class="language-html">&lt;button class=&quot;btn btn-primary&quot; id=&quot;submit&quot; onclick=&quot;submit_message();&quot;&gt;Submit message&lt;/button&gt;
</code></pre>

<p>We&rsquo;re calling the  <code>submit_message()</code>  function when someone clicks the button, fetching the input values and storing them in a JSON object called  <code>entry</code>.</p>

<h3 id="creating-a-json-handler-in-flask">Creating a JSON handler in Flask</h3>

<p>Before we attempt to post any data to our app, we need to create a handler for it.</p>

<p>We&rsquo;re submitting data to our app so we&rsquo;ll need to import  <code>request</code>  from flask.</p>

<p>We&rsquo;re also going to be creating a JSON response so go ahead and import  <code>jsonify</code>  from flask too.</p>

<p>We will also create a response object, so go ahead and import  <code>make_response</code>  from flask.</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">from flask import request, jsonify, make_response` 
</code></pre>

<p>Go ahead and create the following route in your Flask app:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">@app.route(&quot;/guestbook/create-entry&quot;, methods=[&quot;POST&quot;])
def create_entry():

    req = request.get_json()

    print(req)

    res = make_response(jsonify({&quot;message&quot;: &quot;OK&quot;}), 200)

    return res
</code></pre>

<p>For now, we&rsquo;ll just use the  <code>print()</code>  function to print our request data to the terminal and return a simple JSON response.</p>

<h3 id="fetch-setup">Fetch setup</h3>

<p>Let&rsquo;s go back to  <code>guestbook.html</code>  and work on the  <code>submit_message()</code>  function to post some data to our app.</p>

<p>Our fetch function is initially going to look like this:</p>

<pre><code class="language-js">fetch(${window.origin}/guestbook/create-entry, {
    method: &quot;POST&quot;,
    credentials: &quot;include&quot;,
    body: JSON.stringify(entry),
    cache: &quot;no-cache&quot;,
    headers: new Headers({
      &quot;content-type&quot;: &quot;application/json&quot;
    })
  })
  .then(function(response) {
    if (response.status !== 200) {
      console.log(`Looks like there was a problem. Status code: ${response.status}`);
      return;
    }
    response.json().then(function(data) {
      console.log(data);
    });
  })
  .catch(function(error) {
    console.log(&quot;Fetch error: &quot; + error);
});
</code></pre>

<p>Let&rsquo;s take a look at our JavaScript so far and take a quick look at what we&rsquo;re doing:</p>

<pre><code class="language-js">{% block script %}

&lt;script&gt;

  function submit_message() {

    var name = document.getElementById(&quot;name&quot;);
    var message = document.getElementById(&quot;message&quot;);

    var entry = {
      name: name.value,
      message: message.value
    };

    fetch(`${window.origin}/guestbook/create-entry`, {
      method: &quot;POST&quot;,
      credentials: &quot;include&quot;,
      body: JSON.stringify(entry),
      cache: &quot;no-cache&quot;,
      headers: new Headers({
        &quot;content-type&quot;: &quot;application/json&quot;
      })
    })
      .then(function (response) {
        if (response.status !== 200) {
          console.log(`Looks like there was a problem. Status code: ${response.status}`);
          return;
        }
        response.json().then(function (data) {
          console.log(data);
        });
      })
      .catch(function (error) {
        console.log(&quot;Fetch error: &quot; + error);
      });

  }

&lt;/script&gt;

{% endblock %}
</code></pre>

<h3 id="fetch-explained">Fetch explained</h3>

<p><code>fetch()</code>  takes 2 arguments, a URL or  <code>input</code>  and a set of options or  <code>init</code>  as descibed in the fetch documentation.</p>

<p>We&rsquo;ve provided the URL to our Flask JSON handler using  <code>${window.origin}</code>  followed by our URL, along with an init object containing several keys and values to setup the type of request we want to make. In our case:</p>

<ul>
<li><code>method: &quot;POST&quot;</code>  As we&rsquo;re posting data to the server</li>
<li><code>credentials: &quot;include&quot;</code>  To send any cookies from the current domain/client to the server</li>
<li><code>body: JSON.stringify(entry)</code>  Converts our JSON object into a string</li>
<li><code>cache: &quot;no-cache&quot;</code>  We&rsquo;re not interested in any cached data</li>
<li><code>headers: new Headers({&quot;content-type&quot;: &quot;application/json&quot;})</code>  Adds a header to tell the server we&rsquo;re sending JSON</li>
</ul>

<p>You&rsquo;ll then see we&rsquo;ve got  <code>.then()</code>  chained to our  <code>fetch()</code>  request which does some error handling for us, depending on what status code the server responds with. We&rsquo;re going to leave that as is for now.</p>

<p><code>response.json()</code>  parses returned JSON from a string to a JSON object which we can access with the  <code>data</code>  variable passed into the callback function chained to it using  <code>.then()</code>! 😅</p>

<p>The final block is a  <code>.catch()</code>  containing a callback function to catch and handle any errors with our fetch request.</p>

<blockquote>
<p>Tip - The more you use fetch the more it starts to make sense!</p>
</blockquote>

<p>Let&rsquo;s post some data to our route.</p>

<h3 id="posting-with-fetch">Posting with Fetch</h3>

<p>Save the file, reload the browser, fill out the name and message fields and submit the form. You should see a dictionary printed in your terminal along with a JSON response printed to the browser console.</p>

<p>Let&rsquo;s refactor the code in our view to return the same object send to us from the client:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">@app.route(&quot;/guestbook/create-entry&quot;, methods=[&quot;POST&quot;])
def create_entry():

    req = request.get_json()

    print(req)

    res = make_response(jsonify(req), 200)

    return res
</code></pre>

<p>All we do it pass the  <code>req</code>  variable to  <code>jsonify()</code>, which will serialize the Python dictionary into a JSON string.</p>

<p>If you now fill out the form and send another request to the app, you&rsquo;ll see down in the developer tools console our route is now just bouncing back what was sent to it!</p>

<h3 id="takeaways">Takeaways</h3>

<p>The main takeaway from this episode is that asynchronously sending and receiving data betwen the client and the server is relitively simple using the Fetch API.</p>

<p>In the next part of this series, we&rsquo;ll complete our guestbook app where you&rsquo;ll see more of the Fetch API in action! We&rsquo;ll be saving entries and reloading new entries in the background without having to reload the page.</p>

<p>Last modified  ·  28 Feb 2019</p>

<blockquote>
<p>Written with <a href="https://pythonise.com/series/learning-flask/flask-and-fetch-api">StackEdit</a>.</p>
</blockquote>
</article>

      <div class="book-footer justify-between">
  

  

  
  <div>
    <a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/edit/master/exampleSite/content/docs%5cPython%5cFlask%5cLearning-Flask%5cep-10.md" target="_blank">
      <img src="/library/tutorials/svg/edit.svg" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>
  

</div>

      
    </div>

    
  

  <aside class="book-toc levels-true fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#flask-and-the-fetch-api-learning-flask-ep-10">Flask and the Fetch API | Learning Flask Ep. 10</a>
<ul>
<li>
<ul>
<li><a href="#create-a-new-route">Create a new route</a></li>
<li><a href="#collecting-json">Collecting JSON</a></li>
<li><a href="#creating-a-json-handler-in-flask">Creating a JSON handler in Flask</a></li>
<li><a href="#fetch-setup">Fetch setup</a></li>
<li><a href="#fetch-explained">Fetch explained</a></li>
<li><a href="#posting-with-fetch">Posting with Fetch</a></li>
<li><a href="#takeaways">Takeaways</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
</body>

</html>
