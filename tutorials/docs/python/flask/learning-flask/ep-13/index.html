<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Ep.13 Uploading files with Flask"><meta property="og:title" content="Ep.13 Uploading files with Flask" />
<meta property="og:description" content="Uploading files with Flask | Learning Flask Ep. 13 Posting, checking and validating file uploads with Flask
Uploading files to the server is often a requirement of a website or web application. Thankfully, Flask makes this relitively simple for us with a few useful functions.
We&rsquo;re using Bootstrap 4 CSS in this example but feel free to use any other CSS library, use your own or skip the styling completely." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://dragon-library.github.io/library/tutorials/docs/python/flask/learning-flask/ep-13/" />

<title>Ep.13 Uploading files with Flask | Tutorials</title>
<link rel="icon" href="/library/tutorials/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/library/tutorials/book.min.b9a2ef487e6e785fb7a8bd0b0dea3279fe2cce2341ab46d277edb0ee33acb543.css" integrity="sha256-uaLvSH5ueF&#43;3qL0LDeoyef4sziNBq0bSd&#43;2w7jOstUM=">


<script defer src="/library/tutorials/en.search.min.b508edc00498416caddc8d819ea9e81b884f9c65fd543010524c00a3bdbb806e.js" integrity="sha256-tQjtwASYQWyt3I2BnqnoG4hPnGX9VDAQUkwAo727gG4="></script>
<!-- highlight -->
  <link rel="stylesheet" href="https://dragon-library.github.io/library/tutorials/plugins/highlight/hybrid.css">


<!-- match-height JS -->
<script src="https://dragon-library.github.io/library/tutorials/plugins/match-height/jquery.matchHeight-min.js"></script>

<!-- highlight -->
<script src="https://dragon-library.github.io/library/tutorials/plugins/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="flex container">

    <aside class="book-menu fixed">
      <nav>
<h2 class="book-brand">
  <a href="https://dragon-library.github.io/library/tutorials/"><span>Tutorials</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>





    

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/" >
      Python
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/beginer/" >
      Beginners
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/pandas/" >
      Pandas
  </a>


    

    






  </li>


      
    
      
        <li>

  <a href="/library/tutorials/docs/python/pythonthailand/" >
      Python Thailand
  </a>

</li>
      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/snippets/" >
      Snippets
  </a>


    

    






  </li>


      
    
      
        <li>

  <a href="/library/tutorials/docs/python/awesome/" >
      Awesome Python
  </a>

</li>
      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/e-book/" >
      e-Book
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/flask/" >
      Flask
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/python/flask/learning-flask/" >
      Learning Flask
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-1/" >
      Ep.1 Your first Flask app
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-2/" >
      Ep.2 Flask application structure
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-3/" >
      Ep.3 Serving HTML files
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-4/" >
      Ep.4 Serving static files
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-5/" >
      Ep.5 Jinja template inheritance
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-6/" >
      Ep.6 Jinja template design
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-7/" >
      Ep.7 Working with forms in Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-8/" >
      Ep.8 Generating dynamic URLs in Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-9/" >
      Ep.9 Working with JSON data
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-10/" >
      Ep.10 Flask and the Fetch API
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-11/" >
      Ep.11 Query strings in Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-12/" >
      Ep.12 Flask configuration files
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-13/"  class="active">
      Ep.13 Uploading files with Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-14/" >
      Ep.14 Sending files with Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-15/" >
      Ep.15 Flask cookies
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-16/" >
      Ep.16 The Flask session object
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-17/" >
      Ep.17 Flask message flashing
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-18/" >
      Ep.18 Flask error handling
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-19/" >
      Ep.19 Flask HTTP methods
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-20/" >
      Ep.20 The request object
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-21/" >
      Ep.21 Task queues with Flask
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/learning-flask/ep-22/" >
      Ep.22 Pillow, task queues &amp; the HTML picture element
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/primer-jinja-templating/" >
      Primer on Jinja Templating
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/flask/flask-blueprint/" >
      Use a Flask Blueprint
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        <li>

  <a href="/library/tutorials/docs/python/cheat-sheet/" >
      Python Cheat sheet
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/list-python-basics/" >
      List for Tutorial
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/modules-list/" >
      Modules List
  </a>

</li>
      
    
      
        <li>

  <a href="/library/tutorials/docs/python/python-regular-expressions/" >
      Regular Expressions
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/front-end/bootstrap/basic-bootstap/" >
      Bootstrap 4 แบบพื้นฐาน
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/front-end/javascript/" >
      JavaScript
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/backup/" >
      Backup
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/articles/" >
      Articles
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/library/tutorials/docs/book/" >
      Book
  </a>


    

    






  </li>


      
    
  </ul>
  



  











</nav>


<script>
(function() {
  var menu = document.querySelector("aside.book-menu nav");
  addEventListener("beforeunload", function(event) {
    localStorage.setItem("menu.scrollTop", menu.scrollTop);
  });
  menu.scrollTop = localStorage.getItem("menu.scrollTop");
})();
</script>

    </aside>

    <div class="book-page">
      <header class="flex align-center justify-between book-header">
  <label for="menu-control">
    <img src="/library/tutorials/svg/menu.svg" alt="Menu" />
  </label>
  <strong>Ep.13 Uploading files with Flask</strong>
</header>

      
<article class="markdown">

<h1 id="uploading-files-with-flask-learning-flask-ep-13">Uploading files with Flask | Learning Flask Ep. 13</h1>

<p>Posting, checking and validating file uploads with Flask</p>

<p>Uploading files to the server is often a requirement of a website or web application. Thankfully, Flask makes this relitively simple for us with a few useful functions.</p>

<p>We&rsquo;re using Bootstrap 4 CSS in this example but feel free to use any other CSS library, use your own or skip the styling completely.</p>

<p>Let&rsquo;s get started.</p>

<h3 id="create-a-new-route">Create a new route</h3>

<p>We&rsquo;ll start by creating a new route which we&rsquo;ll use to render a template containing a form, which users can use to upload an image.</p>

<blockquote>
<p>Tip - You&rsquo;ll need to import  <code>render_template</code>  from  <code>flask</code>  if you haven&rsquo;t already</p>
</blockquote>

<p>We&rsquo;ll give the route the URL of  <code>/upload-image</code>:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">@app.route(&quot;/upload-image&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])
def upload_image():

    return render_template(&quot;public/upload_image.html&quot;)
</code></pre>

<p>We&rsquo;ll be making a  <code>POST</code>  request to the server, so we&rsquo;ve added  <code>methods=[&quot;GET&quot;, &quot;POST&quot;]</code>  to the route.</p>

<h3 id="upload-form">Upload form</h3>

<p>Now we need to create our HTML template. We&rsquo;ll call it  <code>upload_image.html</code>  and place it in the  <code>templates/public</code>  directory.</p>

<p>Go ahead and add the following:</p>

<p><strong>app/app/templates/public/upload_image.html</strong></p>

<pre><code class="language-html">{% extends &quot;public/templates/public_template.html&quot; %}
{% block title %}Upload{% endblock %}
{% block main %}
&lt;div class=&quot;container&quot;&gt;
  &lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;col&quot;&gt;
      &lt;h1&gt;Upload an image&lt;/h1&gt;
      &lt;hr&gt;
      &lt;form action=&quot;/upload-image&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;
        &lt;div class=&quot;form-group&quot;&gt;
          &lt;label&gt;Select image&lt;/label&gt;
          &lt;div class=&quot;custom-file&quot;&gt;
            &lt;input type=&quot;file&quot; class=&quot;custom-file-input&quot; name=&quot;image&quot; id=&quot;image&quot;&gt;
            &lt;label class=&quot;custom-file-label&quot; for=&quot;image&quot;&gt;Select image...&lt;/label&gt;
          &lt;/div&gt;
        &lt;/div&gt;
        &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;Upload&lt;/button&gt;
      &lt;/form&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/div&gt;

{% endblock %}
</code></pre>

<p>We&rsquo;ve created a new child template containing a form with a single input, a file browser.</p>

<blockquote>
<p>Tip - When uploading images via a form with Flask, you must add the  <code>enctype</code>  attribute to the form with the value  <code>multipart/form-data</code></p>
</blockquote>

<p>Now that we have our form and file browser, we can move on to handling the upload in our route.</p>

<h3 id="accessing-files-in-a-route">Accessing files in a route</h3>

<p>To access a file being posted by a fowm, we use  <code>request.files</code>  provided by the  <code>request</code>  object.
We need to import  <code>request</code>  from flask. We&rsquo;ll also go ahead and import  <code>redirect</code>  too.
<code>from flask import request, redirect</code> Go ahead and refactor the  <code>/upload-image</code>  route to the following:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">@app.route(&quot;/upload-image&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])
def upload_image():

    if request.method == &quot;POST&quot;:
        if request.files:
            image = request.files[&quot;image&quot;]
            print(image)
            return redirect(request.url)

    return render_template(&quot;public/upload_image.html&quot;)
</code></pre>

<ul>
<li>We&rsquo;re veryfying the request method is  <code>POST</code>  with  <code>if request.method == &quot;POST&quot;:</code></li>
<li>We then veryfy if the request contains files with  <code>if request.files:</code></li>
<li>We then store the file as a variable called image using  <code>image = request.files[&quot;image&quot;]</code></li>
</ul>

<p>Using  <code>request.files[&quot;image&quot;]</code>, we&rsquo;re able to access the file from the form with the attribute  <code>name=&quot;image&quot;</code></p>

<p>Adding another file input is as simple as creating another file input field in the HTML form and providing a different value in the  <code>name</code>  attribute.</p>

<p>For example, creating another file input with the attribute  <code>name=&quot;image_2&quot;</code>  could then be accessed in Flask with  <code>request.files[&quot;image_2&quot;]</code></p>

<p>Printing the  <code>image</code>  variable you&rsquo;ll see:</p>

<p><code>&lt;FileStorage: 'example.png' ('image/png')&gt;</code></p>

<p>You&rsquo;ll notice the  <code>FileStorage</code>  class, followed by the filename and the type of file.</p>

<p>FileStroage is a wrapper class around incoming files provided by Werkzeug, Flask&rsquo;s underlying HTTP library which handles incoming request data.</p>

<p>Flask stores incoming file uploads in the webservers memory (If the files are small), otherwise it will store them in a temporary location.</p>

<h3 id="saving-files">Saving files</h3>

<p>We&rsquo;ll start with the quickest and easiest way to save a file.</p>

<p>You&rsquo;ll need the  <code>os</code>  library. Go ahead and import it:</p>

<p><strong>app/app/views.py</strong></p>

<p><code>import os</code></p>

<p>We should specify a directory to save our uploaded images which we&rsquo;ll add to our  <code>app.config</code>  object. You don&rsquo;t have to do this but it&rsquo;s best practice.</p>

<p>Either create a variable in your config file with  <code>IMAGE_UPLOADS = /path/to/uploads/folder</code>  or asssign it directly to  <code>app.config[&quot;IMAGE_UPLOADS&quot;]</code>.</p>

<blockquote>
<p>TIp - You should provide a complete path, making sure any directories in the path exist</p>
</blockquote>

<p>In this example, we&rsquo;re going to assign the  <code>IMAGE_UPLOADS</code>  config attribute in our app but I&rsquo;d recommend you create it in your app config file.</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">app.config[&quot;IMAGE_UPLOADS&quot;] = &quot;/mnt/c/wsl/projects/pythonise/tutorials/flask_series/app/app/static/img/uploads&quot;` 
</code></pre>

<p>As you can see, we have a long but complete path!</p>

<p>To save the file, we simply call  <code>image.save()</code>  and join the path to the uploads folder with the filename using  <code>os.join()</code>:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">image.save(os.path.join(app.config[&quot;IMAGE_UPLOADS&quot;], image))
</code></pre>

<p>Our route now looks like this:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">from flask import request, redirect
import os

app.config[&quot;IMAGE_UPLOADS&quot;] = &quot;/mnt/c/wsl/projects/pythonise/tutorials/flask_series/app/app/static/img/uploads&quot;

@app.route(&quot;/upload-image&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])
def upload_image():
    if request.method == &quot;POST&quot;:
        if request.files:
            image = request.files[&quot;image&quot;]
            image.save(os.path.join(app.config[&quot;IMAGE_UPLOADS&quot;], image.filename))
            print(&quot;Image saved&quot;)
            return redirect(request.url)

    return render_template(&quot;public/upload_image.html&quot;)
</code></pre>

<p>We use  <code>image.filename</code>  to access the filename of the image and join that with the path to the uploads folder with  <code>os.join()</code>.</p>

<p>Save the file and upload an image to see it in action.</p>

<h3 id="securing-file-uploads">Securing file uploads</h3>

<p>At this point, a user could upload any kind of file of any filesize, which is dangerous..</p>

<blockquote>
<p>Tip - NEVER TRUST USER INPUT</p>
</blockquote>

<p>To mitigate any damage our application might receive from a malicius actor or user error, we should consider the following:</p>

<ul>
<li>Ensuring the file has a name</li>
<li>Ensuring the file type is allowed</li>
<li>Ensuring the filename is allowed</li>
<li>Ensuring the filesize is allowed</li>
</ul>

<p>Let&rsquo;s start with the filename.</p>

<p>Ensuring the file has a filename is a simple fix:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">if image.filename == &quot;&quot;:
    print(&quot;No filename&quot;)
    return redirect(request.url)
</code></pre>

<p>To ensure the type of file is allowed, we should create a set of allowed extensions in our  <code>app.config</code>.</p>

<p>We&rsquo;ll just stick to image extensions for now but you&rsquo;ll need to modify this to allow other file types.</p>

<p>Go ahead and add the following:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">app.config[&quot;ALLOWED_IMAGE_EXTENSIONS&quot;] = [&quot;JPEG&quot;, &quot;JPG&quot;, &quot;PNG&quot;, &quot;GIF&quot;]
</code></pre>

<p>This declares we&rsquo;re only going to accept 4 file extensions for image uploads.</p>

<p>We should create a function that we can call to confirm this:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">def allowed_image(filename):
    # We only want files with a . in the filename
    if not &quot;.&quot; in filename:
        return False
    # Split the extension from the filename
    ext = filename.rsplit(&quot;.&quot;, 1)[1]
    # Check if the extension is in ALLOWED_IMAGE_EXTENSIONS
    if ext.upper() in app.config[&quot;ALLOWED_IMAGE_EXTENSIONS&quot;]:
        return True
    else:
        return False
</code></pre>

<p>Ensuring the filename itself isn&rsquo;t dangerous is probably even more important. Luckily for us, Werkzeug provides a handy function called  <code>secure_filename</code>  that we can call to return a secure filename.</p>

<p>First of all we need to import it:</p>

<p><strong>app/app/views.py</strong></p>

<p><code>from werkzeug.utils import secure_filename</code></p>

<p>We can now call it to return a secure filename of our file:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">filename = secure_filename(image.filename)` 
</code></pre>

<p>Lastly, we need to modify  <code>image.save()</code>  to include the safe filename:</p>

<p><strong>app/app/views.py</strong></p>

<p><code>image.save(os.path.join(app.config[&quot;IMAGE_UPLOADS&quot;], filename))</code></p>

<p>Putting everything together, our app now looks like this:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">from flask import request, redirect
from werkzeug.utils import secure_filename
import os

app.config[&quot;IMAGE_UPLOADS&quot;] = &quot;/mnt/c/wsl/projects/pythonise/tutorials/flask_series/app/app/static/img/uploads&quot;
app.config[&quot;ALLOWED_IMAGE_EXTENSIONS&quot;] = [&quot;JPEG&quot;, &quot;JPG&quot;, &quot;PNG&quot;, &quot;GIF&quot;]

def allowed_image(filename):
    if not &quot;.&quot; in filename:
        return False
    ext = filename.rsplit(&quot;.&quot;, 1)[1]
    if ext.upper() in app.config[&quot;ALLOWED_IMAGE_EXTENSIONS&quot;]:
        return True
    else:
        return False

@app.route(&quot;/upload-image&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])
def upload_image():
    if request.method == &quot;POST&quot;:
        if request.files:
            image = request.files[&quot;image&quot;]
            if image.filename == &quot;&quot;:
                print(&quot;No filename&quot;)
                return redirect(request.url)
            if allowed_image(image.filename):
                filename = secure_filename(image.filename)
                image.save(os.path.join(app.config[&quot;IMAGE_UPLOADS&quot;], filename))
                print(&quot;Image saved&quot;)
                return redirect(request.url)
            else:
                print(&quot;That file extension is not allowed&quot;)
                return redirect(request.url)

    return render_template(&quot;public/upload_image.html&quot;)
</code></pre>

<p>Lastly, we should ensure the file is of an acceptable filesize.</p>

<p>Just like we did with specifying the allowed image extensions in the app config. We can do the same with the maximum filesize using the default  <code>MAX_CONTENT_LENGTH</code>  config variable.</p>

<p>Let&rsquo;s set our maximum filesize at around 50 megabytes:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">app.config['MAX_CONTENT_LENGTH'] = 50 * 1024 * 1024
</code></pre>

<p>This setting will apply globally to all uploads sent to your application, which may or may not be ideal.</p>

<h3 id="limiting-file-upload-size">Limiting file upload size</h3>

<p>I&rsquo;ve been unable to find a way to read the filesize using the Flask or Werkzeug utilities, so had to find another creative way.</p>

<p>There may be instances where you need users to upload different file types, all with different filesize restrictions.</p>

<p>An alternative to using  <code>MAX_CONTENT_LENGTH</code>  is to send the filesize as a cookie along with the file, validate the filesize and then decide whether to save the file of not.</p>

<p>In order to achieve this, we&rsquo;re going to do the following:</p>

<ul>
<li>Create a JavaScript function that saves the filesize as a cookie</li>
<li>Set a maximum filesize limit for images in the app config</li>
<li>Create a function to validate the image filesize</li>
</ul>

<p>Let&rsquo;s create the JavaScript function to listen for an  <code>oninput</code>  event and attach it to the file  <code>input</code>  field:</p>

<pre><code class="language-js">&lt;script&gt;

  function filesize(elem){
    document.cookie = `filesize=${elem.files[0].size}`
  }

&lt;/script&gt;`
</code></pre>

<p>We also need to attach the  <code>oninput</code>  event to the  <code>input</code>  field and call the function:</p>

<p><code>&lt;input type=&quot;file&quot; class=&quot;custom-file-input&quot; name=&quot;image&quot; id=&quot;image&quot; oninput=&quot;filesize(this);&quot;&gt;</code></p>

<p>Now, when the user changes the input value, a cookie is saved and send to our app when the form is submitted.</p>

<p>Let&rsquo;s set a  <code>MAX_IMAGE_FILESIZE</code>  in our app config:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">app.config[&quot;MAX_IMAGE_FILESIZE&quot;] = 0.5 * 1024 * 1024
</code></pre>

<p>We&rsquo;ve set it at around 500,00 bytes for testing purposes.</p>

<p>Next up, we&rsquo;ll need to create a function to validate the filesize:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">def allowed_image_filesize(filesize):

    if int(filesize) &lt;= app.config[&quot;MAX_IMAGE_FILESIZE&quot;]:
        return True
    else:
        return False
</code></pre>

<p>Cookies come in as strings, so we pass the  <code>filesize</code>  cookie to the  <code>int()</code>  function to convert it.</p>

<p>We access cookies using  <code>request.cookies</code>, a dictionary like object which we can extract values by key.</p>

<p>Finally, let&rsquo;s grab the cookie and call the  <code>allowed_image_filesize</code>  function, passing the value to it:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">if &quot;filesize&quot; in request.cookies:

    if not allowed_image_filesize(request.cookies[&quot;filesize&quot;]):
        print(&quot;Filesize exceeded maximum limit&quot;)
        return redirect(request.url)
</code></pre>

<p>Our finished app now looks like this:</p>

<p><strong>app/app/views.py</strong></p>

<pre><code class="language-py">from flask import request, redirect
from werkzeug.utils import secure_filename

import os

app.config[&quot;IMAGE_UPLOADS&quot;] = &quot;/mnt/c/wsl/projects/pythonise/tutorials/flask_series/app/app/static/img/uploads&quot;
app.config[&quot;ALLOWED_IMAGE_EXTENSIONS&quot;] = [&quot;JPEG&quot;, &quot;JPG&quot;, &quot;PNG&quot;, &quot;GIF&quot;]
app.config[&quot;MAX_IMAGE_FILESIZE&quot;] = 0.5 * 1024 * 1024

def allowed_image(filename):

    if not &quot;.&quot; in filename:
        return False

    ext = filename.rsplit(&quot;.&quot;, 1)[1]

    if ext.upper() in app.config[&quot;ALLOWED_IMAGE_EXTENSIONS&quot;]:
        return True
    else:
        return False

def allowed_image_filesize(filesize):

    if int(filesize) &lt;= app.config[&quot;MAX_IMAGE_FILESIZE&quot;]:
        return True
    else:
        return False

@app.route(&quot;/upload-image&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])
def upload_image():

    if request.method == &quot;POST&quot;:

        if request.files:

            if &quot;filesize&quot; in request.cookies:

                if not allowed_image_filesize(request.cookies[&quot;filesize&quot;]):
                    print(&quot;Filesize exceeded maximum limit&quot;)
                    return redirect(request.url)

                image = request.files[&quot;image&quot;]

                if image.filename == &quot;&quot;:
                    print(&quot;No filename&quot;)
                    return redirect(request.url)

                if allowed_image(image.filename):
                    filename = secure_filename(image.filename)

                    image.save(os.path.join(app.config[&quot;IMAGE_UPLOADS&quot;], filename))

                    print(&quot;Image saved&quot;)

                    return redirect(request.url)

                else:
                    print(&quot;That file extension is not allowed&quot;)
                    return redirect(request.url)

    return render_template(&quot;public/upload_image.html&quot;)
</code></pre>

<p>Go ahead and try to upload an image over 500,000 bytes. It should print  <code>&quot;Filesize exceeded maximum limit&quot;</code></p>

<p>Last modified  ·  28 Feb 2019</p>

<blockquote>
<p>Written with <a href="https://pythonise.com/series/learning-flask/flask-uploading-files">StackEdit</a>.</p>
</blockquote>
</article>

      <div class="book-footer justify-between">
  

  

  
  <div>
    <a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/edit/master/exampleSite/content/docs%5cPython%5cFlask%5cLearning-Flask%5cep-13.md" target="_blank">
      <img src="/library/tutorials/svg/edit.svg" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>
  

</div>

      
    </div>

    
  

  <aside class="book-toc levels-true fixed">
    <nav id="TableOfContents">
<ul>
<li><a href="#uploading-files-with-flask-learning-flask-ep-13">Uploading files with Flask | Learning Flask Ep. 13</a>
<ul>
<li>
<ul>
<li><a href="#create-a-new-route">Create a new route</a></li>
<li><a href="#upload-form">Upload form</a></li>
<li><a href="#accessing-files-in-a-route">Accessing files in a route</a></li>
<li><a href="#saving-files">Saving files</a></li>
<li><a href="#securing-file-uploads">Securing file uploads</a></li>
<li><a href="#limiting-file-upload-size">Limiting file upload size</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </aside>



  </main>

  
</body>

</html>
